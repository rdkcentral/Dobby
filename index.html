<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dobby: Dobby</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Dobby
   &#160;<span id="projectnumber">3.0</span>
   </div>
   <div id="projectbrief">Dobby “Docker based Thingy” is a tool for managing and running OCI containers using crun</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a><img src="https://img.shields.io/github/v/release/rdkcentral/Dobby" alt="GitHub release (with filter)" class="inline"/><img src="https://img.shields.io/github/license/rdkcentral/Dobby" alt="GitHub" class="inline"/><img src="https://img.shields.io/github/issues-pr-raw/rdkcentral/Dobby" alt="Github" class="inline"/><img src="https://img.shields.io/github/issues/rdkcentral/Dobby" alt="Github" class="inline"/></p>
<p><a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> “Docker based Thingy” is a tool for managing and running OCI containers using <a href="https://github.com/containers/crun">crun</a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Getting Started</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Requirements</h2>
<p><a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> has the following dependencies</p>
<ul>
<li>CMake (&gt;3.7)</li>
<li>crun (&gt;=0.13)</li>
<li>jsoncpp</li>
<li>yajl 2 (for libocispec)</li>
<li>ctemplate (if using <code>LEGACY_COMPONENTS</code>)</li>
<li>libsystemd</li>
<li>libnl (if using Networking plugin)</li>
<li>libnl-route (if using Networking plugin)</li>
<li>libdbus</li>
<li>boost (1.61)</li>
</ul>
<h2><a class="anchor" id="autotoc_md3"></a>
Build</h2>
<p><a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> is a CMake project and can be built with the standard CMake workflow. To build, run the following commands.</p>
<div class="fragment"><div class="line">cd /location/of/dobby/repo</div>
<div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line"> </div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Debug ../</div>
<div class="line"> </div>
<div class="line">make -j$(numproc)</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><p>During the CMake configure stage, CMake will also configure the <code>libocispec</code> submodule. This is used to generate the necessary C headers for parsing and manipulating OCI bundle specifications.</p>
<p>If the schema files in the <code>bundle/runtime-schemas</code> directory are changed, then you will need to re-run CMake again to regenerate the headers.</p>
<p>When building for the development VM, use the following CMake command: </p><div class="fragment"><div class="line">cmake -DCMAKE_BUILD_TYPE=Debug -DRDK_PLATFORM=DEV_VM -DCMAKE_INSTALL_PREFIX:PATH=/usr ../</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md4"></a>
CMake Configuration Settings</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Option   </th><th class="markdownTableHeadLeft">Valid Options   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>-CMAKE_BUILD_TYPE</code>   </td><td class="markdownTableBodyLeft">Debug/Release   </td><td class="markdownTableBodyLeft">Build the Debug or Release version    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>-DENABLE_DOBBYTOOL</code>   </td><td class="markdownTableBodyLeft">ON/OFF   </td><td class="markdownTableBodyLeft">Include DobbyTool in the build. For Debug builds, defaults to ON. For Release builds, defaults to OFF.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>-DPLUGIN_PATH</code>   </td><td class="markdownTableBodyLeft">Valid UNIX path   </td><td class="markdownTableBodyLeft">Specify a different location to load RDK plugins from. Defaults to <code>/usr/lib/plugins/dobby</code> if not set    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>-DRDK_PLATFORM</code>   </td><td class="markdownTableBodyLeft"><code>GENERIC</code><br  />
 <code>DEV_VM</code>   </td><td class="markdownTableBodyLeft">Specify which platform <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> is running on. Defaults to <code>GENERIC</code> if none specified. DEV_VM changes some settings suitable for Vagrant    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>-DSETTINGS_FILE</code>   </td><td class="markdownTableBodyLeft">Valid UNIX path   </td><td class="markdownTableBodyLeft">Path to the settings JSON file to use for <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> (will be installed to /etc/dobby.json)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>-DSETTINGS_APPEND</code>   </td><td class="markdownTableBodyLeft">Valid UNIX path   </td><td class="markdownTableBodyLeft"><a class="el" href="classSettings.html" title="Object containing the settings to pass to the Dobby.">Settings</a> to append to the base settings file as defined in <code>-DSETTINGS_FILE</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>-DLEGACY_COMPONENTS</code>   </td><td class="markdownTableBodyLeft">ON/OFF   </td><td class="markdownTableBodyLeft">Enable or disable legacy components (legacy plugins, <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> specs, ...). Defaults to OFF    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>-DENABLE_LTO</code>   </td><td class="markdownTableBodyLeft">ON/OFF   </td><td class="markdownTableBodyLeft">Enable Link Time Optimisation (<a href="https://gcc.gnu.org/onlinedocs/gccint/LTO-Overview.html">https://gcc.gnu.org/onlinedocs/gccint/LTO-Overview.html</a>). Requires GCC &gt;4,5 although versions &gt;6 are strongly recommended. Defaults to <code>OFF</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>-DENABLE_PERFETTO_TRACING</code>   </td><td class="markdownTableBodyLeft">ON/OFF   </td><td class="markdownTableBodyLeft">Option to enable or disable Perfetto tracing. Can not be enabled for release builds. Requires Perfetto SDK to be installed, and Legacy Components enabled    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>-DDOBBY_SERVICE</code>   </td><td class="markdownTableBodyLeft">Reverse domain name string   </td><td class="markdownTableBodyLeft">Specify the <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> dbus service name. Defaults to <code>org.rdk.dobby</code> if none specified.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>-DDDOBBY_OBJECT</code>   </td><td class="markdownTableBodyLeft">Valid UNIX path   </td><td class="markdownTableBodyLeft">Specify the <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> dbus object path. Defaults to <code>/org/rdk/dobby</code> if none specified.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>-DUSE_STARTCONTAINER_HOOK</code>   </td><td class="markdownTableBodyLeft">ON/OFF   </td><td class="markdownTableBodyLeft">Whether to use the startcontainer OCI hook or not. Defaults to OFF.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>-DUSE_SYSTEMD</code>   </td><td class="markdownTableBodyLeft">ON/OFF   </td><td class="markdownTableBodyLeft">Build with systemd support (recommended). When disabled, uses libdbus API instead of sd-bus. Defaults to ON.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>-DEXTERNAL_PLUGIN_SCHEMA</code>   </td><td class="markdownTableBodyLeft">Valid file path(s)   </td><td class="markdownTableBodyLeft">Path(s) to external json schema definitions for extra rdk plugins. Paths should be seperated by <code>;</code>.   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md5"></a>
Enable/Disable Plugins</h4>
<p>In addition to all the above, each RDK plugin has a setting for enabling it for builds. The <code>Logging</code>, <code>Networking</code>, <code>IPC</code>, <code><a class="el" href="classStorage.html" title="Dobby RDK Storage Plugin.">Storage</a></code> and <code><a class="el" href="classMinidump.html" title="Dobby RDK Minidump Plugin.">Minidump</a></code> plugins are enabled by default.</p>
<p>Use <code>-DPLUGIN_[PLUGINNAME]=[ON|OFF]</code> to enable or disable plugins for your build.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Development</h1>
<p>If you with to develop <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> further, detailed instructions on setting up a development environment can be found in the <code>develop</code> directory in this repo, including a Vagrant VM with all the necessary dependencies pre-installed.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Documentation</h1>
<ul>
<li>A high level overview of <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> can be found at RDKCentral <a href="https://wiki.rdkcentral.com/display/ASP/Dobby+Documentation">here</a></li>
<li>Code documentation can be generated with Doxygen by running <code>doxygen ./Doxyfile</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md8"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
DobbyDaemon</h2>
<p>This is the main component of <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a>. This daemon is responsible for managing, controlling and creating containers. The daemon runs in the background and communicates over dbus. It connects on a few dbus addresses - one for admin, one for debugging and the other for <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> commands.</p>
<p>DobbyDaemon can be started as a systemd service at system boot (the systemd service file can be found at <code>daemon/process/dobby.service</code>) or run manually on the command line by running:</p>
<div class="fragment"><div class="line">DobbyDaemon --nofork</div>
</div><!-- fragment --><p>Additional <code>-v</code> flags can be passed to the daemon to increase it's log verbosity for troubleshooting as needed</p>
<div class="fragment"><div class="line">Usage: DobbyDaemon &lt;option(s)&gt;</div>
<div class="line">  Daemon that starts / stops / manages containers.</div>
<div class="line"> </div>
<div class="line">  -h, --help                    Print this help and exit</div>
<div class="line">  -v, --verbose                 Increase the log level</div>
<div class="line">  -V, --version                 Display this program&#39;s version number</div>
<div class="line"> </div>
<div class="line">  -f, --settings-file=PATH      Path to a JSON dobby settings file [/etc/dobby.json]</div>
<div class="line">  -a, --dbus-address=ADDRESS    The dbus address to put the admin service on [system bus]</div>
<div class="line">  -p, --priority=PRIORITY       Sets the SCHED_RR priority of the daemon [RR,12]</div>
<div class="line">  -n, --nofork                  Do not fork and daemonise the process</div>
<div class="line">  -k, --noconsole               Disable console output</div>
<div class="line">  -g, --syslog                  Send all initial logging to syslog rather than the console</div>
<div class="line">  -j, --journald                Enables logging to journald</div>
<div class="line"> </div>
<div class="line">  Besides the above options the daemon checks for the follow environment variables</div>
<div class="line"> </div>
<div class="line">  AI_WORKSPACE_PATH=&lt;PATH&gt;      The path to tmpfs dir to use as workspace</div>
<div class="line">  AI_PERSISTENT_PATH=&lt;PATH&gt;     The path to dir that is persistent across boots</div>
<div class="line">  AI_PLATFORM_IDENT=&lt;IDENT&gt;     The 4 characters than make up the STB platform id</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md10"></a>
DobbyBundleGenerator</h2>
<p>This is a command-line wrapper around the <code>DobbyBundleGen</code> library, and allows <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> spec JSON files to be converted to extended OCI bundles (aka Bundle*'s) with RDK plugin sections. It does not require the DobbyDaemon to be running, so can be run on or off-box.</p>
<div class="fragment"><div class="line">Usage: DobbyBundleGenerator &lt;option(s)&gt;</div>
<div class="line">  Tool to convert Dobby JSON spec to OCI bundle without needing a running Dobby Daemon</div>
<div class="line"> </div>
<div class="line">  -h, --help                    Print this help and exit</div>
<div class="line">  -v, --verbose                 Increase the log level</div>
<div class="line"> </div>
<div class="line">  -s, --settings=PATH           Path to Dobby Settings file for STB</div>
<div class="line">  -i, --inputpath=PATH          Path to Dobby JSON Spec for container</div>
<div class="line">  -o, --outputDirectory=PATH    Where to save the generated OCI bundle</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md11"></a>
DobbyTool</h2>
<p>This is a simple command line tool that is used for debugging purporses. It connects to the <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> daemon over dbus and allows for debugging and testing containers.</p>
<div class="fragment"><div class="line">vagrant@dobby-vagrant:~$ DobbyTool help</div>
<div class="line">quit              quit</div>
<div class="line">help              help [command]</div>
<div class="line">shutdown          shutdown</div>
<div class="line">start             start [options...] &lt;id&gt; &lt;specfile/bundlepath&gt; [command]</div>
<div class="line">stop              stop &lt;id&gt; [options...]</div>
<div class="line">pause             pause &lt;id&gt;</div>
<div class="line">resume            resume &lt;id&gt;</div>
<div class="line">exec              exec [options...] &lt;id&gt; &lt;command&gt;</div>
<div class="line">list              list</div>
<div class="line">info              info &lt;id&gt;</div>
<div class="line">dumpspec          dumpspec &lt;id&gt; [options...]</div>
<div class="line">bundle            bundle &lt;id&gt; &lt;specfile&gt; [options...]</div>
<div class="line">set-dbus          set-dbus &lt;private&gt;|&lt;public&gt; &lt;address&gt;</div>
</div><!-- fragment --><p> For more information about a command, run <code>DobbyTool help [command]</code>. For example: </p><div class="fragment"><div class="line">$ DobbyTool help start</div>
<div class="line">start             start [options...] &lt;id&gt; &lt;specfile/bundlepath&gt; [command]</div>
<div class="line"> </div>
<div class="line">Starts a container using the given spec file or bundle path. Can optionally specify the command to run inside the container. Any arguments after command are treated as arguments to the command.</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
DobbyPluginLauncher</h2>
<p>This is designed to be run from the OCI runtime to execute <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> RDK plugins. It loads plugins from the <code>/usr/lib/plugins/dobby</code> directory (configurable at build-time), and runs the appropriate methods based on the specified hook and plugin data.</p>
<div class="fragment"><div class="line">Usage: DobbyPluginLauncher &lt;option(s)&gt;</div>
<div class="line">  Tool to run Dobby plugins loaded from /usr/lib/plugins/dobby</div>
<div class="line"> </div>
<div class="line">  -H, --help                    Print this help and exit</div>
<div class="line">  -v, --verbose                 Increase the log level</div>
<div class="line"> </div>
<div class="line">  -h, --hook                    Specify the hook to run</div>
<div class="line">  -c, --config=PATH             Path to container OCI config</div>
</div><!-- fragment --><p>To use <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> RDK plugins in a container launched via <code>DobbyDaemon</code>, the OCI bundle config should have <code>ociVersion</code> set to <code>1.0.2-dobby</code> and an <code>rdkPlugins</code> object with plugins present. <code>DobbyDaemon</code> will set up <a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> and OCI hooks to execute the plugins' hookpoints with <code>DobbyPluginLauncher</code>.</p>
<p>An example of the <code>rdkPlugins</code> object's syntax with the <code>networking</code> plugin:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">   &quot;rdkPlugins&quot;:{</div>
<div class="line">      &quot;networking&quot;:{        // plugin name</div>
<div class="line">         &quot;required&quot;:true,   // whether to throw an error if the plugin is missing, or just flag a warning and carry on</div>
<div class="line">         &quot;data&quot;:{           // data to be passed to the plugin - can contain any valid JSON, depending on the plugin</div>
<div class="line">            &quot;type&quot;:&quot;nat&quot;    // each plugin has its own accepted data structure</div>
<div class="line">         }</div>
<div class="line">      }</div>
<div class="line">   }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md13"></a>
DobbyInit</h2>
<p>This tool is a simple 'init' process for containers. Instead of relying on runc to manage the lifecycle of processes within the container, DobbyInit is responsible for reaping adopted child processes and forwarding signals to child processes. The motivation for this tool is described here: <a href="https://blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem">https://blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem</a>. It is installed in <code>/usr/libexec</code>.</p>
<div class="fragment"><div class="line">Usage: DobbyInit &lt;process-to-run&gt; &lt;arg1&gt; &lt;arg2&gt; ... &lt;argN&gt;</div>
</div><!-- fragment --><hr  />
 <h1><a class="anchor" id="autotoc_md15"></a>
Copyright and license</h1>
<p>If not stated otherwise in this file or this component's LICENSE file the following copyright and licenses apply:</p>
<p>Copyright 2020 Sky UK</p>
<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>
<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Note</h2>
<p><a class="el" href="classDobby.html" title="The root Dobby object, runs the dbus loop.">Dobby</a> makes use of the <a href="https://github.com/containers/libocispec">libocispec</a> library to parse and generate OCI configurations from JSON schemas. This is a code-generator and used only at build-time. <code>libocispec</code> is GPLv3 licensed but includes a specific exception for this purpose. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
